# CMS_GE21_QC

## QC2 Processing Scripts

This repository contains scripts for processing GEM QC2 (Quality Control 2) test data. The scripts handle data processing, visualization, and report generation for GEM foil testing.

## üöÄ Quick Start

The easiest way to process QC2 data is using the integrated script:

```bash
python3 Run_QC2.py
```

The script will interactively:
1. Ask for the data directory path (supports tab completion)
2. Check for existing files and offer to skip steps
3. Process the data in sequence

### üìÇ Directory Structure

Your data directory should contain:
```
data_directory/
‚îú‚îÄ‚îÄ QC2LONG_PART1_<foil_name>_<date>_<time>.txt    # Raw QC2 data files
‚îú‚îÄ‚îÄ QC2_all_channels_monitor_<date>_<time>.txt      # All channels monitoring data
‚îú‚îÄ‚îÄ plots/                                          # Generated by the scripts
‚îî‚îÄ‚îÄ pdf_reports/                                    # Generated by the scripts
```

### ‚öôÔ∏è Processing Flow

1. **Megger File Generation**
   - Creates `QC2FAST_<foil_name>_<date>.txt` files
   - Requires manual input of impedance and spark values
   - Date format: YYYYMMDD

2. **IV Plot Generation**
   - Creates IV plots from QC2LONG_PART1 files
   - Generates both PNG plots and data TXT files
   - Automatically processes all foils in the directory

3. **PDF Report Generation**
   - Combines all data into comprehensive PDF reports
   - Creates individual report for each foil
   - Includes plots, measurements, and notes

### ‚ö†Ô∏è Important Notes

- **Data Path**: Make sure to provide the correct path containing QC2LONG_PART1 files
- **File Names**: Don't modify the standard naming conventions
- **Existing Files**: The script will warn you about existing files and offer to skip steps
- **Manual Input**: Pay attention when entering impedance and spark values - they cannot be automatically corrected

### üíª Example Operation

```bash
$ python3 Run_QC2.py

Welcome to QC2 Processing
------------------------

Please enter the data path: ../data_ME0_foils_20241204

Found existing QC2FAST (megger) files in the directory.
Do you want to skip Step 1 (megger file generation)? (y/n): n

Please enter the date info for QC2FAST (YYYYMMDD): 20241204

Step 1: Generating megger files
------------------------------
Creating megger file for ME0-G12-KR-B08-0027

For time 0.5 minutes:
Impedance (GOhm) for time 0.5: 35
Sparks for time 0.5: 0

[... continues for all time points ...]

Step 2: Generating IV plots
-------------------------
Processing ME0-G12-KR-B08-0027...

Step 3: Generating QC2 reports
----------------------------
Created report: QC2REPORT_ME0-G12-KR-B08-0027_20241204_15-30.pdf

QC2 processing completed successfully!
```

## üìö Individual Scripts

### 1. QC2_megger_generator.py

Generates megger test files for each foil.

```bash
python3 QC2_megger_generator.py <data_folder> <date>
```

Example:
```bash
python3 QC2_megger_generator.py ../data_ME0_foils_20241204 20241204
```

‚ö†Ô∏è **Important**: 
- Date must be in YYYYMMDD format
- You'll need to enter impedance and spark values for each time point
- Values can be corrected before file creation

### 2. QC2_IV-plot-generator.py

Generates I-V characteristic plots and data files.

```bash
python3 QC2_IV-plot-generator.py <data_folder>
```

Example:
```bash
python3 QC2_IV-plot-generator.py ../data_ME0_foils_20241204
```

Features:
- Automatically processes all foils in directory
- Creates both PNG plots and TXT data files
- Filters out current spikes above threshold (7 nA default)

### 3. QC2_report.py

Generates comprehensive PDF reports for each foil.

```bash
python3 QC2_report.py <data_folder>
```

Example:
```bash
python3 QC2_report.py ../data_ME0_foils_20241204
```

The report includes:
- Foil identification information
- Megger test results
- I-V characteristic plots
- Long-term stability plots
- Test notes and comments

## üîç Troubleshooting

Common issues and solutions:

1. **Missing Files**
   ```
   Error: No QC2LONG_PART1 files found in '<path>'
   ```
   ‚Üí Check if you're providing the correct data directory path

2. **Invalid Date Format**
   ```
   Error: Megger date must be in YYYYMMDD format
   ```
   ‚Üí Make sure to use the correct date format (e.g., 20241204)

3. **Existing Files**
   ```
   Warning: Found existing files in the directory
   ```
   ‚Üí You can choose to skip steps or regenerate files

## üìù Notes

- Always verify the data path before processing
- Keep consistent naming conventions for files
- Back up important data before reprocessing
- Check generated files for correctness after each step